(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){var vect=require("../utilities/vector2D");var AABB=function(realX,realY,x,y,width,height){this.width=width;this.height=height;this.minBoundX=realX+x;this.minBoundY=realY+y;this.maxBoundX=this.minBoundX+width;this.maxBoundY=this.minBoundY+height;this.offsetX=x;this.offsetY=y;this.center=vect.create((x+width)/2,(y+height)/2)};AABB.prototype.collidesWith=function(b){if(this.minBoundX>b.maxBoundX||this.minBoundY>b.maxBoundY||this.maxBoundX<b.minBoundX||this.maxBoundY<b.minBoundY){return false}return true};AABB.prototype.updatePos=function(realX,realY){this.minBoundX=realX+this.offsetX;this.minBoundY=realY+this.offsetY;this.maxBoundX=this.minBoundX+this.width;this.maxBoundY=this.minBoundY+this.height;this.center.x=(this.minBoundX+this.width)/2;this.center.y=(this.minBoundY+this.height)/2};module.exports=AABB},{"../utilities/vector2D":16}],2:[function(require,module,exports){var Vector2D=require("../../utilities/vector2D");var Control=function(name,label){this.name=name;this.engageCallback=null;this.showBorder=false;this.backgroundImg=null;this.backgroundFill="#333";this.borderColor="#333";this.borderWidth=1;this.borderRadius=5;this.label=label||"Control Default";this.labelFont="Helvetica,sans-serif";this.labelSize="24px";this.labelPaddingX=10;this.height=48;this.width=100;this.pos=Vector2D.create(100,100);this.vel=Vector2D.create(0,0);this.acc=Vector2D.create(0,0)};Control.prototype.engage=function(){if(typeof this.engageCallback==="function"){this.engageCallback()}else{console.error("Unable to engage control function on control: ",this.name)}};Control.prototype.update=function(dt){this.vel.x+=this.acc.x*dt;this.pos.x+=1/2*this.acc.x*(dt*dt)+this.vel.x*dt;this.vel.y+=this.acc.y*dt;this.pos.y+=1/2*this.acc.y*(dt*dt)+this.vel.y*dt};Control.prototype.draw=function(ctx){ctx.beginPath();if(this.backgroundImg){ctx.drawImage(this.backgroundImg,this.pos.x,this.pos.y,this.width,this.height)}ctx.fillStyle=this.backgroundFill;ctx.strokeStyle=this.borderColor;ctx.font=this.labelSize+" "+this.labelFont;ctx.textBaseline="middle";ctx.fillText(this.label,this.pos.x+this.labelPaddingX,this.pos.y+this.height/2);if(this.showBorder){ctx.moveTo(this.pos.x,this.pos.y+this.borderRadius);ctx.lineTo(this.pos.x,this.pos.y+this.height-this.borderRadius);ctx.quadraticCurveTo(this.pos.x,this.pos.y+this.height,this.pos.x+this.borderRadius,this.pos.y+this.height);ctx.lineTo(this.pos.x+this.width-this.borderRadius,this.pos.y+this.height);ctx.quadraticCurveTo(this.pos.x+this.width,this.pos.y+this.height,this.pos.x+this.width,this.pos.y+this.height-this.borderRadius);ctx.lineTo(this.pos.x+this.width,this.pos.y+this.borderRadius);ctx.quadraticCurveTo(this.pos.x+this.width,this.pos.y,this.pos.x+this.width-this.borderRadius,this.pos.y);ctx.lineTo(this.pos.x+this.borderRadius,this.pos.y);ctx.quadraticCurveTo(this.pos.x,this.pos.y,this.pos.x,this.pos.y+this.borderRadius);ctx.stroke()}};module.exports=Control},{"../../utilities/vector2D":16}],3:[function(require,module,exports){exports.loadImg=function(path,callback){var img=new Image;img.addEventListener("load",function(ev){console.log("image loaded",path,ev);if(typeof callback==="function"){callback(img)}});img.src=path};exports.batchLoad=function(paths,callback){var out=[];for(var i=0;i<paths.length;i++){var tmpImg=new Image;tmpImg.addEventListner("load",function(ev){out.push(tmpImg);if(out.length===paths.length){if(typeof callback==="function"){callback(out)}else{console.log("images loaded but callback not specified!")}}});tmpImg.src=paths[i]}}},{}],4:[function(require,module,exports){var Input=function Input(name,keyCode,callback,keyup){this.name=name;this.keyCode=keyCode;this.keydownCallback=callback||function(){};this.keyupCallback=keyup||function(){};this.isPressed=false;this.isSystemInput=false};var inputs=[],inputMap={},currentState=null;exports.init=function(){document.addEventListener("keydown",function(ev){ev.preventDefault();ev.stopPropagation();var tmpInput=inputs[ev.keyCode]||"undefined";tmpInput.isPressed=true;if(tmpInput!=="undefined"&&tmpInput.isSystemInput){tmpInput.keydownCallback()}});document.addEventListener("keyup",function(ev){ev.preventDefault();ev.stopPropagation();var tmpInput=inputs[ev.keyCode]||"undefined";tmpInput.isPressed=false;tmpInput!=="undefined"?tmpInput.keyupCallback():console.log("undefined keyup",tmpInput)})};exports.addInput=function(name,keyCode,keydownCallback,keyupCallback,systemInput){keydownCallback=typeof keydownCallback==="function"?keydownCallback:function(){};keyupCallback=typeof keyupCallback==="function"?keyupCallback:function(){};var newInput=new Input(name,keyCode,keydownCallback,keyupCallback);inputs[keyCode]=newInput;inputMap[name]=keyCode};exports.addSystemInput=function(name,keyCode,keydownCallback){keydownCallback=typeof keydownCallback==="function"?keydownCallback:function(){};var newInput=new Input(name,keyCode,keydownCallback);newInput.isSystemInput=true;inputs[keyCode]=newInput;inputMap[name]=keyCode};exports.removeInput=function(name){if(inputMap[name]){var out=inputs[inputMap[name]]=undefined;inputMap[name]=undefined}};exports.getInputCollection=function(){return inputs};exports.useState=function(newState){for(var i=0;i<newState.inputs.length;i++){var tmpInput=newState.inputs[i];inputs[tmpInput.keyCode]=tmpInput;inputMap[tmpInput.name]=tmpInput.keyCode}currentState=newState;return newState};exports.getState=function(){return currentState};exports.createInput=function(name,keyCode,keydownCallback,keyupCallback){keydownCallback=typeof keydownCallback==="function"?keydownCallback:function(){};keyupCallback=typeof keyupCallback==="function"?keyupCallback:function(){};return new Input(name,keyCode,keydownCallback,keyupCallback)}},{}],5:[function(require,module,exports){var GameState=require("./state"),Control=require("./controls/control"),Entity=require("../entity/entity"),Vector2D=require("../utilities/vector2D"),ObjArray=require("../utilities/objarray");var Menu=function(name,title){GameState.call(this,name);this.title=title||null;this.titleFont="lighter 128px Helvetica Neue, sans-serif";this.titleFontStyle="#0091ff";this.titlePos=Vector2D.create(0,0);this.pos=Vector2D.create(0,0);this.vel=Vector2D.create(0,0);this.acc=Vector2D.create(0,0);this._selectedIndex=0;this.controls=new ObjArray;this.selector=new Entity;this.selector.addFrame("select","./src/resources/selector.png",1e3);this.selector.direction="select"};Menu.prototype=Object.create(GameState.prototype);Menu.prototype.addControl=function(name,label,callback){var tmpCtrl=new Control(name,label),numCtrls=this.controls.length();tmpCtrl.engageCallback=typeof callback==="function"?callback:function(){console.log("Callback not set on control: ",name)};tmpCtrl.pos.y=numCtrls*50;this.controls.add(name,tmpCtrl);console.log("control added: ",name)};Menu.prototype.addControlObj=function(ctrl,callback){if(typeof callback==="function"){ctrl.engageCallback=callback}this.controls.add(ctrl.name,ctrl)};Menu.prototype.engage=function(ctrlName){var name=ctrlName||this._selectedIndex,ctrl=this.controls.get(name);if(ctrl){ctrl.engage()}else{console.log("invalid control selected, index:",name," length: ",this.controls.length())}};Menu.prototype.changeSelected=function(direction,numChanged){if(direction==="down"){this._selectedIndex+=numChanged||1;if(this._selectedIndex>=this.controls.length()){this._selectedIndex=0}}else if(direction==="up"){this._selectedIndex-=numChanged||1;if(this._selectedIndex<0){this._selectedIndex=this.controls.length()-1}}else if(direction==="left"){}else if(direction==="right"){}};Menu.prototype.pollInput=function(inputMap,inputCollection){};Menu.prototype.update=function(dt){};Menu.prototype.drawFrom=function(rend,direction,totalTime,step){};Menu.prototype.draw=function(rend){this.constructor.prototype.draw.call(this,rend);if(this.title){rend.ctx.beginPath();rend.ctx.font=this.titleFont;rend.ctx.fillStyle=this.titleFontStyle;rend.ctx.fillText(this.title,this.titlePos.x,this.titlePos.y)}for(var i=0;i<this.controls.length();i++){this.controls.get(i).draw(rend.ctx)}this.selector.pos.x=this.controls.get(this._selectedIndex).pos.x-50;this.selector.pos.y=this.controls.get(this._selectedIndex).pos.y+5;this.selector.draw(rend.ctx)};module.exports=Menu},{"../entity/entity":11,"../utilities/objarray":14,"../utilities/vector2D":16,"./controls/control":2,"./state":7}],6:[function(require,module,exports){var rend={ctx:null,height:0,width:0,state:null};exports.init=function(context,width,height,state){rend.ctx=context;rend.width=width;rend.height=height;rend.state=state||null};exports.useState=function(newState){if(typeof newState!="undefined"){rend.state=newState;rend.state.player=newState.player}};exports.draw=function(gameState){renderState=gameState||rend.state;if(rend.ctx!=null){if(renderState!=null){renderState.draw(rend)}else{console.log("Game state is not set!")}}else{console.log("drawing context is not set!")}}},{}],7:[function(require,module,exports){var inputManager=require("./input-manager"),imageManager=require("./image");var State=function State(name){this.name=name;this.player=null;this.enemies=[];this.npcs=[];this.interactables=[];this.scenery={backdrop:null,background:null,foreground:null};this.inputs=[];this.hud=null;this.plainText=null;this.optionalRenderingFunction=null;this.alert={text:null,font:"bold 64px Helvetica Neue, sans-serif",alpha:1,style:"rgba(51, 51, 51, 1)",baseStyle:"rgba(51, 51, 51, 1)",top:100,complete:function(){}}};State.prototype.addPlayerToState=function(player){this.player=player};State.prototype.addEnemyToState=function(enemy){if(enemy.length){for(var i=0;i<enemy.length;i++){this.enemies.push(enemy[i])}}else{this.enemies.push(enemy)}};State.prototype.addNPCToState=function(npc){if(npc.length){for(var i=0;i<npc.length;i++){this.npcs.push(npc[i])}}else{this.npcs.push(npc)}};State.prototype.addInteractableToState=function(interactable){if(interactable.length){for(var i=0;i<interactable.length;i++){this.interactables.push(interactable[i])}}else{this.interactables.push(interactable)}};State.prototype.addInput=function(name,keyCode,keydownCallback,keyupCallback){this.inputs.push(inputManager.createInput(name,keyCode,keydownCallback,keyupCallback))};State.prototype.addSystemInput=function(name,keyCode,keydownCallback){var input=inputManager.createInput(name,keyCode,keydownCallback);input.isSystemInput=true;this.inputs.push(input)};State.prototype.setBackdrop=function(path,callback){var state=this;imageManager.loadImg(path,function(img){state.scenery.backdrop=img;if(typeof callback==="function"){callback()}})};State.prototype.setBackground=function(path,callback){var state=this;imageManager.loadImg(path,function(img){state.scenery.background=img;if(typeof callback==="function"){callback()}})};State.prototype.setForeground=function(path,callback){var state=this;imageManager.loadImg(path,function(img){state.scenery.foreground=img;if(typeof callback==="function"){callback()}})};State.prototype.addOptionalRendering=function(callback){this.optionalRenderingFunction=typeof callback==="function"?callback:null};State.prototype.setAlert=function(text,options){this.alert.text=text;this.alert.font=options&&options.font?options.font:"bold 128px Helvetica Neue, sans-serif";this.alert.alpha=options&&options.alpha?options.alpha:1;this.alert.style=options&&options.style?options.style:"#333333";this.alert.baseStyle=options&&options.style?options.style:"#333333";this.alert.top=options&&options.top?options.top:100;this.alert.complete=options&&options.complete?options.complete:null};State.prototype.update=function(dt){if(this.alert.text){if(this.alert.alpha>0){this.alert.alpha-=.01;if(this.alert.baseStyle[0]==="#"){if(this.alert.baseStyle.length===7){var r=parseInt(this.alert.baseStyle.substring(1,3),16),g=parseInt(this.alert.baseStyle.substring(3,5),16),b=parseInt(this.alert.baseStyle.substring(5,7),16);this.alert.style="rgba("+r+","+b+","+b+","+this.alert.alpha+")"}else if(this.alert.baseStyle.length===4){var r=parseInt(this.alert.baseStyle.substring(1,2)+this.alert.baseStyle.substring(1,2),16),g=parseInt(this.alert.baseStyle.substring(2,3)+this.alert.baseStyle.substring(2,3),16),b=parseInt(this.alert.baseStyle.substring(3,4)+this.alert.baseStyle.substring(3,4),16);this.alert.style="rgba("+r+","+b+","+b+","+this.alert.alpha+")"}}var curr=this.alert.alpha;if(curr-.01<=0){this.alert.text=null;if(typeof this.alert.complete==="function"){this.alert.complete()}}}}if(this.player){this.player.pollInput(inputManager.getInputCollection());this.player.update(dt)}if(this.enemies.length>0){for(var i=0;i<this.enemies.length;i++){if(this.enemies[i]){this.enemies[i].update(dt);if(this.player.aabbs[0].collidesWith(this.enemies[i].aabbs[0])){}for(var a=0;a<this.player.currAttacks.length;a++){if(this.player.currAttacks[a].aabbs[0].collidesWith(this.enemies[i].aabbs[0])){this.enemies.splice(i,1);break}}}}}if(this.npcs.length>0){}if(this.interactables.length>0){}};State.prototype.draw=function(rend){if(rend.ctx!=null){rend.ctx.clearRect(0,0,rend.width,rend.height);if(this.scenery.backdrop!=null){}if(this.scenery.background!=null){rend.ctx.drawImage(this.scenery.background,0,0)}if(this.npcs.length>0){}if(this.interactables.length>0){}if(this.enemies.length>0){for(var i=0;i<this.enemies.length;i++){var e=this.enemies[i];if(e!=null){e.draw(rend.ctx)}}}if(this.player!=null){this.player.draw(rend.ctx)}if(this.scenery.foreground!=null){rend.ctx.drawImage(this.scenery.foreground,0,rend.height-250)}if(this.hud!=null){}if(this.plainText!=null){rend.ctx.beginPath();rend.ctx.font="lighter 25pt Helvetica Neue,sans-serif";rend.ctx.fillText(this.plainText,0,rend.height/2)}if(this.alert.text!=null){rend.ctx.beginPath();rend.ctx.font=this.alert.font;rend.ctx.fillStyle=this.alert.style;var x=rend.width/2-rend.ctx.measureText(this.alert.text).width/2;rend.ctx.fillText(this.alert.text,x,this.alert.top)}if(this.optionalRenderingFunction!=null){this.optionalRenderingFunction(rend.ctx)}}else{console.log("drawing context is not set!")}};module.exports=State},{"./image":3,"./input-manager":4}],8:[function(require,module,exports){var _Frame=function _Frame(path,ms,completeCallback){this.img=new Image;this.frameTime=ms;this.img.addEventListener("load",function(ev){console.log("loaded:",path," -- frame: ",this)});this.img.src=path;this.completedCallback=typeof completeCallback==="function"?completeCallback:null};var Animation=function Animation(){this._frames=[];this.numFrames=0;this.currTime=0;this.currIndex=0;this.loop=true;this.completedCallback};Animation.prototype.addFrame=function(path,ms,completedCallback,loadCallback){var frame=new _Frame(path,ms,completedCallback,loadCallback);this._frames.push(frame);this.numFrames++};Animation.prototype.addAnimationCompletedCallback=function(callback){this.completedCallback=typeof callback==="function"?callback:function(){console.log("callback not a function")}};Animation.prototype.update=function(dt){this.currTime+=dt;if(this._frames[this.currIndex]){if(this.currTime>=this._frames[this.currIndex].frameTime){this.currTime%=this._frames[this.currIndex].frameTime;if(this._frames[this.currIndex].completedCallback!=null){this._frames[this.currIndex].completedCallback()}this.currIndex++}if(this.currIndex>=this.numFrames){if(!this.loop){this.completedCallback()}this.reset()}}};Animation.prototype.getCurrImg=function(){return this._frames[this.currIndex].img};Animation.prototype.reset=function(){this.currTime=0;this.currIndex=0};module.exports=Animation},{}],9:[function(require,module,exports){var Entity=require("./entity"),AABB=require("../core/boundingbox");var Attack=function(){Entity.call(this);this.realX=0;this.realY=0;this.objX=0;this.objY=0};Attack.prototype=Object.create(Entity.prototype);Attack.prototype.addAABB=function(x,y,width,height){var box=new AABB(this.pos.x,this.pos.y,x,y,width,height);this.aabbs.push(box)};Attack.prototype.update=function(dt,nrX,nrY){this.realX=nrX;this.realY=nrY;this.pos.x=this.realX+this.objX;this.pos.y=this.realY+this.objY;this.updateRungeKutta(dt)};module.exports=Attack},{"../core/boundingbox":1,"./entity":11}],10:[function(require,module,exports){var Entity=require("./entity"),AABB=require("../core/boundingbox");var Enemy=function(){Entity.call(this)};Enemy.prototype=Object.create(Entity.prototype);Enemy.prototype.addAABB=function(x,y,width,height){var box=new AABB(this.pos.x,this.pos.y,x,y,width,height);this.aabbs.push(box)};Enemy.prototype.update=function(dt){this.updateRungeKutta(dt)};module.exports=Enemy},{"../core/boundingbox":1,"./entity":11}],11:[function(require,module,exports){var vect=require("../utilities/vector2D"),Animation=require("./animation"),AABB=require("../core/boundingbox");var Entity=function Entity(){this.pos=vect.create(0,0);this.vel=vect.create(0,0);this.accel=vect.create(0,0);this.prev_pos=vect.create(0,0);this.mass=5;this.maxhp=100;this.currhp=100;this.inventory={};this.equipment={};this.upgrades={};this.direction="left";this.dirLock=false;this.animations={left:new Animation};this.drawOptions={scaledWidth:.5,scaledHeight:.5};this.aabbs=[]};Entity.prototype.addFrame=function(animation,path,ms,completedCallback){var anim=this.animations[animation]||new Animation;anim.addFrame(path,ms,completedCallback);this.animations[animation]=anim};Entity.prototype.setAnimationLoop=function(anim,loop){if(this.animations[anim]){this.animations[anim].loop=loop}else{console.log("not a defined animation",anim)}};Entity.prototype.addAnimationCompletedCallback=function(anim,callback){if(this.animations[anim]){if(typeof callback==="function"){this.animations[anim].addAnimationCompletedCallback(callback)}}else{console.log(anim,"not a defined animation",anim)}};Entity.prototype.setDirection=function(dir){if(this.animations[this.direction]){this.animations[this.direction].reset();this.direction=dir||this.direction}};Entity.prototype.stop=function(){this.accel.x=0;this.accel.y=0;this.vel.x=0;this.vel.y=0};Entity.prototype.updateVerlet=function(dt){this.vel.x=2*this.pos.x-this.prev_pos.x;console.log(this.vel.x);this.pos.x=2*this.pos.x-this.prev_pos.x+this.accel.x*dt*dt;this.pos.y=2*this.pos.y-this.prev_pos.y+this.accel.y*dt*dt;this.prev_pos.x=this.pos.x;this.prev_pos.y=this.pos.y;this.animations[this.direction].update(dt)};Entity.prototype.updateRungeKutta=function(dt,stepsize){var k1,k2,k3,k4,h=stepsize||.2;k1=this.vel.x+this.accel.x*dt;k2=this.vel.x+k1/2+this.accel.x*(dt/2);k3=this.vel.x+k2/2+this.accel.x*(dt/2);k4=this.vel.x+k3+this.accel.x*dt;this.pos.x+=dt/6*(k1+2*k2+2*k3+k4);this.vel.x+=this.accel.x*dt;k1=this.vel.y+this.accel.y*dt;k2=this.vel.y+k1/2+this.accel.y*(dt+dt/2);k3=this.vel.y+k2/2+this.accel.y*(dt+dt/2);k4=this.vel.y+k3+this.accel.y*dt;this.pos.y+=dt/6*(k1+2*k2+2*k3+k4);this.vel.y+=this.accel.y*dt;if(this.animations[this.direction]){this.animations[this.direction].update(dt)}for(var i=0;i<this.aabbs.length;i++){this.aabbs[i].updatePos(this.pos.x,this.pos.y)}};Entity.prototype.draw=function(ctx){var anim=this.animations[this.direction],img=anim?anim.getCurrImg():null;if(img!=null){ctx.drawImage(img,this.pos.x,this.pos.y,this.animations[this.direction].getCurrImg().width*this.drawOptions.scaledWidth,this.animations[this.direction].getCurrImg().height*this.drawOptions.scaledHeight)}};module.exports=Entity},{"../core/boundingbox":1,"../utilities/vector2D":16,"./animation":8}],12:[function(require,module,exports){var Entity=require("./entity"),AABB=require("../core/boundingbox.js");var Player=function Player(){Entity.call(this);this.state="idle";this.attacks={};this.currAttacks=[];this.inputMap={}};Player.prototype=Object.create(Entity.prototype);Player.prototype.addAABB=function(x,y,width,height){var box=new AABB(this.pos.x,this.pos.y,x,y,width,height);this.aabbs.push(box)};Player.prototype.addAttack=function(attackName,attack){this.attacks[attackName]=attack};Player.prototype.setInputMap=function(map){this.inputMap=map};Player.prototype.update=function(dt){this.updateRungeKutta(dt);for(var i=0;i<this.currAttacks.length;i++){this.currAttacks[i].update(dt,this.pos.x,this.pos.y)}};Player.prototype.pollInput=function(inputCollection,customInputMap){var playerInput,inputMap=customInputMap||this.inputMap;for(var name in inputMap){playerInput=inputCollection[inputMap[name]]||null;if(playerInput!=null&&playerInput.isPressed){inputCollection[inputMap[name]].keydownCallback()}}};Player.prototype.attack=function(attackString){var curr=this.attacks[attackString],found=false;if(curr){for(var i=0;i<this.currAttacks.length;i++){found=curr===this.currAttacks[i]?true:false}if(!found){this.currAttacks.push(curr)}}else{console.log("undefined attackString: ",attackString)}};Player.prototype.removeAttack=function(attackString){var curr=this.attacks[attackString];if(curr){for(var i=0;i<this.currAttacks.length;i++){if(this.currAttacks[i]===curr){this.currAttacks.splice(i,1);break}}}else{console.log("undefined attackString: ",attackString)}};Player.prototype.draw=function(ctx){var img=this.animations[this.direction].getCurrImg();if(img!=null){ctx.drawImage(img,this.pos.x,this.pos.y,this.animations[this.direction].getCurrImg().width*this.drawOptions.scaledWidth,this.animations[this.direction].getCurrImg().height*this.drawOptions.scaledHeight)}for(var i=0;i<this.currAttacks.length;i++){if(this.currAttacks[i]){this.currAttacks[i].direction=this.direction;this.currAttacks[i].draw(ctx)}}};module.exports=Player},{"../core/boundingbox.js":1,"./entity":11}],13:[function(require,module,exports){var canvas=document.getElementById("playground"),ctx=canvas.getContext("2d"),now=typeof performance!=="undefined"?performance.now():+new Date,prev=typeof performance!=="undefined"?performance.now():+new Date,dt=0,currState,anim,Entity=require("./entity/entity"),GameState=require("./core/state"),Enemy=require("./entity/enemy"),Control=require("./core/controls/control"),Menu=require("./core/menu"),Input=require("./core/input-manager"),Renderer=require("./core/renderer"),Resource=require("./utilities/resource"),player,startMenu=new Menu("start"),game=new GameState("game"),loading=new GameState("loading"),gameover=new GameState("gameover"),enemies=[],PLAYER_INPUT_MAP={attack:32,left:65,right:68,up:87,down:83};function init(){var width=document.body.clientWidth;var height=document.body.clientHeight;var dpr=window.devicePixelRatio||1,bsr=ctx.webkitBackingStorePixelRatio||ctx.mozBackingStorePixelRatio||ctx.msBackingStorePixelRatio||ctx.oBackingStorePixelRatio||ctx.backingStorePixelRatio||1,ratio=dpr/bsr;if(dpr!==bsr){canvas.width=width*ratio;canvas.height=height*ratio;canvas.style.width=width+"px";canvas.style.height=height+"px";canvas.getContext("2d").scale(ratio,ratio)}Input.init();player=Resource.loadPlayerDefinition();player.setInputMap(PLAYER_INPUT_MAP);player.direction="right";player.dirLock=true;for(var i=0;i<5;i++){var jagwar=new Enemy;jagwar.addFrame("left","./src/resources/jagwar-left.png",300);jagwar.addFrame("left","./src/resources/jagwar-left-2.png",300);jagwar.pos.x=canvas.width-50;jagwar.pos.y=45+100*i;jagwar.accel.x=-2e-5+Math.random()*-1e-5;jagwar.addAABB(0,0,150,63);enemies.push(jagwar)}for(var j=0;j<5;j++){var jagwar=new Enemy;jagwar.addFrame("left","./src/resources/jagwar-left.png",300);jagwar.addFrame("left","./src/resources/jagwar-left-2.png",300);jagwar.pos.x=canvas.width+150;jagwar.pos.y=20+100*j;jagwar.accel.x=-2e-5+Math.random()*-1e-5;jagwar.addAABB(0,0,150,63);enemies.push(jagwar)}game.addEnemyToState(enemies);game.addInput("right",68,function(){player.vel.x=.4;if(player.state!="attacking"){player.direction="walk-right"}},function(){player.vel.x=0;if(player.state!="attacking"){player.setDirection("right")}});game.addInput("left",65,function(){player.vel.x=-.4;if(player.state!="attacking"){player.direction="walk-right"}},function(){player.vel.x=0;if(player.state!="attacking"){player.setDirection("right")}});game.addInput("up",87,function(){if(player.state!="attacking"){player.direction="walk-right"}player.vel.y=-.4},function(){if(player.state!="attacking"){player.setDirection("right")}player.vel.y=0});game.addInput("down",83,function(){if(player.state!="attacking"){player.direction="walk-right"}player.vel.y=.4},function(){if(player.state!="attacking"){player.setDirection("right")}player.vel.y=0});game.addInput("attack",32,function(){if(player.state!="attacking"){player.direction="attack-right";player.dirLock=true;player.state="attacking";player.attack("basic")}});var alertTest=new GameState("alert");var startCtrl=new Control("start","New Game"),optionsCtrl=new Control("options","Options"),quitCtrl=new Control("quit","Quit Game");startCtrl.pos.x=width/2-100;startCtrl.pos.y=height-150;optionsCtrl.pos.x=width/2-100;optionsCtrl.pos.y=height-100;quitCtrl.pos.x=width/2-100;quitCtrl.pos.y=height-50;startMenu.title="Super Party Horse";startMenu.titleFont="lighter 148px Helvetica Neue";ctx.beginPath();ctx.font=startMenu.titleFont;startMenu.titlePos.x=width/2-ctx.measureText(startMenu.title).width/2;ctx.closePath();startMenu.titlePos.y=100;startMenu.addSystemInput("engage",13,function(){startMenu.engage()});startMenu.addSystemInput("up",87,function(){startMenu.changeSelected("up")});startMenu.addSystemInput("down",83,function(){startMenu.changeSelected("down")});startMenu.addControlObj(startCtrl,function(){currState=Input.useState(game);Renderer.useState(game)});startMenu.addControlObj(optionsCtrl,function(){alertTest.setAlert("Level 1",{complete:function(){}});currState=Input.useState(alertTest);Renderer.useState(alertTest)});startMenu.addControlObj(quitCtrl,function(){window.close()});game.addPlayerToState(player);game.setBackground("./src/resources/grass-background.png");game.setForeground("./src/resources/grass-foreground.png");Input.addSystemInput("stop",27,function(){currState=Input.useState(startMenu);Renderer.useState(startMenu)});Renderer.init(ctx,width,height,startMenu);currState=Input.useState(startMenu)}function update(timestamp){anim=requestAnimationFrame(update);now=timestamp;dt=now-prev;prev=now;currState.update(dt);Renderer.draw()}init();anim=requestAnimationFrame(update)},{"./core/controls/control":2,"./core/input-manager":4,"./core/menu":5,"./core/renderer":6,"./core/state":7,"./entity/enemy":10,"./entity/entity":11,"./utilities/resource":15}],14:[function(require,module,exports){var ObjArray=function(){this._obj={};this._arr=[]};ObjArray.prototype.add=function(name,obj){this._obj[name]=obj;this._arr.push(name)};ObjArray.prototype.remove=function(name){this._obj[name]=null;for(var i=0;i<this._arr.length;i++){if(this._arr[i]===name){this._arr.splice(i,1)}}};ObjArray.prototype.get=function(id){if(typeof id==="string"){return this._obj[id]}else if(typeof id==="number"){return this._obj[this._arr[id]]}};ObjArray.prototype.length=function(){return this._arr.length};module.exports=ObjArray},{}],15:[function(require,module,exports){var Player=require("../entity/player"),AABB=require("../core/boundingbox"),Entity=require("../entity/entity"),Attack=require("../entity/attack");exports.loadResourceFile=function(path){};exports.exportObject=function(obj){};exports.loadPlayerDefinition=function(){var player=new Player,basicAttack=new Attack;player.pos.y=100;player.pos.x=100;player.addFrame("right","./src/resources/donkey-idle-right.png",1e3);player.addFrame("left","./src/resources/donkey-idle-left.png",1e3);player.addFrame("attack-right","./src/resources/attack/donkey-attack-end-right.png",400);player.addFrame("attack-left","./src/resources/attack/donkey-attack-end-left.png",400);player.addFrame("walk-right","./src/resources/donkey-walk-1.png",250);player.addFrame("walk-right","./src/resources/donkey-walk-2.png",250);player.addFrame("walk-right","./src/resources/donkey-walk-3.png",250);player.addFrame("walk-right","./src/resources/donkey-walk-2.png",250);basicAttack.addFrame("attack-right","./src/resources/attack/sound-waves-right.png",400);basicAttack.addFrame("attack-left","./src/resources/attack/sound-waves-left.png",400);basicAttack.realX=player.pos.x;basicAttack.realY=player.pos.y;basicAttack.objX=150;basicAttack.objY=20;basicAttack.addAABB(0,0,63,51);player.addAttack("basic",basicAttack);player.addAnimationCompletedCallback("attack-right",function(){console.log("attack-right completed");player.setDirection("right");player.state="idle";player.removeAttack("basic")});player.addAnimationCompletedCallback("attack-left",function(){console.log("attack-left completed");player.setDirection("right");player.state="idle";player.removeAttack("basic")});player.setAnimationLoop("attack-left",false);player.setAnimationLoop("attack-right",false);player.direction="right";player.addAABB(0,0,126.5,125);return player};exports.loadEnemyDefinition=function(numEnemies){}},{"../core/boundingbox":1,"../entity/attack":9,"../entity/entity":11,"../entity/player":12}],16:[function(require,module,exports){var Vector2D=function(x,y){this.x=x||0;this.y=y||0};Vector2D.prototype.add=function(v2){this.x+=v2.x;this.y+=v2.y};Vector2D.prototype.diff=function(v2){this.x=v2.x-this.x;this.y=v2.y-this.y};Vector2D.prototype.scalar=function(s){this.x*=s;this.y*=s};Vector2D.prototype.normalize=function(){var dd=this.x*this.x+this.y*this.y,d=Math.sqrt(dd);this.x=this.x/d;this.y=this.y/d};Vector2D.prototype.magnitude=function(){var dd=this.x*this.x+this.y*this.y,d=Math.sqrt(dd);return d};Vector2D.prototype.dotProduct=function(v2){return this.x*v2.x+this.y*v2.y};exports.create=function(x,y){return new Vector2D(x,y)};exports.add=function(v1,v2){return new Vector2D(v1.x+v2.x,v1.y+v2.y)};exports.diff=function(v1,v2){return new Vector2D(v2.x-v1.x,v2.y-v1.y)};exports.scalar=function(v1,s){return new Vector2D(v1.x*s,v1.y*s)};exports.normalize=function(v1){var dd=v1.x*v1.x+v1.y*v1.y;d=Math.sqrt(dd);return new Vector2D(v1.x/d,v1.y/d)};exports.magnitude=function(v1){var dd=v1.x*v1.x+v1.y*v1.y,d=Math.sqrt(dd);return d};exports.dotProduct=function(v1,v2){return v1.x*v2.x+v1.y*v2.y}},{}]},{},[13]);